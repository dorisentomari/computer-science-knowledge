# 1. 数据的宽度和存储

## 1.1 数据的宽度和单位

二进制数据的每一位（0 或 1）是组成二进制信息的最小单位，称为一个比特(bit)，或称为位。比特是计算机存储、运算和传输信息的最小单位。

每个西文字符需要用 8 个比特表示，而每个汉字需要用 16 个比特才能表示。在计算机内部，二进制信息的计量单位是字节(byte)，也称为位组，一个字节等于 8 个比特。

计算机的一个很重要的指标就是机器的 **字长**，就是平时说的 32 位或者 64 位。机器字长通常是指 CPU 内部用于整数运算的数据通路的宽度。CPU 内部数据通路是指 CPU 内部的数据流经的路径以及路径上的部件，主要是 CPU 内部进行数据运算、存储和传送的部件，这些部件的宽度基本上要一致才能匹配。因此，字长等于 CPU 内部用于整数运算的运算器位数和通用寄存器的宽度。

## 1.2 数据的存储和排列顺序

最低有效位(Least Significant Bit，LSB)表示数的最低位。

最高有效位(Most Significant Bit，MSB)表示数的最高位。

对于带符号的数，最高位就是符号位，所以 MSB 就是符号位。

在计算机中，多字节数都被存放在连续的字节序列中。根据数据中各字节在连续字节序列中的排列顺序不同，可有两种排列方式：大端(big endian)和小端(little endian)

**大端方式** 将数据的最高有效字节存放在低地址单元中，将最低有效字节存放在高地址单元中，即数据的地址就是 MSB 所在的地址。

**小端方式** 将数据的最高有效字节存放在高地址单元中，将最低有效字节存放在低地址单元中，即数据的地址就是 LSB 所在的地址。


# 2. 数据的基本运算

## 2.1 MOS 晶体管工作原理

晶体管可以根据控制端电压或电流的变化来实现“开启”和“关闭”功能，从而表达二进制。

晶体管主要分为双极型二极管(Bipolar Junction Transistor) 和金属-氧化物半导体场效应晶体管(Metal Oxide Semiconductor Field Effect Transistor，简称 MOSFET 或 MOS)

当前绝大多数 CPU 都采用 MOS 晶体管实现，其中又以 CMOS(Complementary Metal Oxide Semiconductor) 晶体管电路设计最为常见。

+ 半导体：MOS 晶体管使用硅作为基本材料。
+ NMOS 和 PMOS 晶体管

## 2.2 CMOS 逻辑电路

### 2.2.1 数字逻辑电路

+ 布尔代数：最基本的逻辑运算有三种 `与(AND，&)`，`或(OR，|)`，`非(NOT，~)`
    + 恒等律：`A | 0 = A，A & 1 = A`
    + 0/1律：`A | 1 = 1，A & 0 = 0`
    + 互补律：`A | (~A) = 1，A & (~A) = 0`
    + 交换律：`A | B = B | A，A & B = B & A`
    + 结合律：`A | (B | C) = (A | C) | B，A & (B & C) = (A & B) & C`
    + 分配律：`A & (B | C) = (A & B) | (A & C)，A | (B & C) = (A & B) | (A & C)`
    + 德摩根定律：`~(A & B) = (~A) | (~B)，~(A | B) = (~A) | (~B)`
+ 组合逻辑：
    + 组合逻辑电路中没有数据存储单元，电路的输出完全由当前的输入决定。在组合逻辑的各种表达方式中，最简单的就是真值表，即对每一种可能的输入组合给出输出值。所以一个 N 输入的电路就有 2 的 N 次方种不同的输入组合。
    + 利用基本逻辑门电路可以构成具有特定功能的更功能的组合的逻辑部件，如译码器，编码器，多路选择器，加法器等。
+ 时序逻辑：
    + 时序逻辑电路包含时钟信号和数据存储单元两个要素。
    + 特点：输出不惮于当前的输入的逻辑有关，还与在此之前曾经输入的逻辑值有关。
    + 时钟信号时时序逻辑电路的基础，用于确定时序逻辑逻辑原件种的状态在何时发生变化。

### 2.2.2 常见 CMOS 电路

+ 非门：非门也称作反相器的 CMOS 电路，有一个 PMOS 晶体管和一个 NMOS 晶体管组成，其中 P 管(PMOS) 的源极接电源，N 管(NMOS 晶体管)的源极接地，两管的漏极连载一起作为输出，栅极连在一起作为输入。
+ 与非门
+ 或非门
+ 传输门
+ D 触发器

## 2.3 按位运算和逻辑运算
+ 位运算
    + 按位与(AND) `&`
    + 按位或(OR) `|`
    + 按位非(NOT) `~`
    + 按位异或(XOR) `^`

位运算的一个重要运用就是实现掩码(masking)操作，通过与给定的一个位模式进行按位与，可以提取所需要的位，然后对这些位进行 `置1`、`清 0`、`是否为 1 测试`、`是否为 0 测试` 等，这里的位模式就被成为掩码。 

+ 逻辑运算
    + 且运算(AND) `&&`
    + 或运算(OR) `||`
    + 非运算(NOT) `!`

## 2.4 移位

+ 左移时，高位移出，低位补 0。
+ 右移时，低位移出，高位补 0。
+ 对于无符号整数的逻辑左移，如果最高位移出的是 1，则发生溢出。

## 2.5 整数加减运算

只有两个加数的符号相同时才可能发生溢出。两个加数都是正数时发生的溢出称为正溢出。两个加数都是负数时发生溢出称为负溢出。

在 Intel x86 架构中，不管高级语言程序中定义的变量是带符号整数还是无符号整数类型，对应的加减法指令都一样。

在 MIPS 架构中，提供了专门的带符号整数的加减指令和无符号整数的加减指令，因而在 MIPS 处理器中的运算电路中会区分是带符号整数还是无符号整数。区别在于带符号整数加减时会判断溢出并对溢出做出处理，而无符号整数加减时不判断溢出，其余部分是一样的。

## 2.6 常量乘除运算

由于整数乘法运算比移位和加法等运算所用时间长的多，通常一次乘法运算需要 10 个左右的时钟周期，而一次移位、加法和减法等运算只要一个或更少的时钟周期。

因此，编译器在处理变量与常数相乘时，往往以移位、加法和减法的组合运算来代替乘法运算。

无论是无符号整数还是带符号整数的乘法，即时计算结果发生了溢出，利用移位和加法运算组合的方式得到的结果都是一样的。

对于整数除法，由于不能采用流水线方式实现，所以一次除法运算大概需要 30 多个甚至更多的时钟周期。为了缩短除法运算时间，编译器在处理一个变量与一个 2 的幂次形式的整数相处时，尝采用右移运算来实现。

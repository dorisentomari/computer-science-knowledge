# 1. 数制和编码

![计算机外部信息与内部数据的转换](../images/计算机外部信息与内部数据的转换.png)

计算机内存储和处理信息的最小单位是位(bit)，也叫 比特，值可以是 0 或 1，不可把 bit 再分为更小的信息单位。

数字计算机将信息以一组或一串比特（字）的形式保存在存储器中。

在 x86 计算机中，所有数据存储的基本单位都是字节(byte)，一个字节有 8 位。其他的存储单位还有字(word，两个字节)，双字(double word，四个字节)，四字(quadword，八个字节)。

## 1.1 计算机中数的表示
+ 二进制只有 0 和 1 两个数，其编码、计数和运算规则都很简单，特别是其中 0 和 1 可以对应逻辑命题中的 “假” 和 ”真“，因为能通过逻辑电路方便地实现算术运算。
+ 二进制只能两种基本状态，使用有两个稳定状态的物理元件九年呢表示二进制数中的每一位。
+ 计算机表示一个数的三要素：进位制、定浮点表示、编码规则
+ 计算机中只有 0 和 1，无法表示小数点。所以通过约定小数点的位置来解决。
+ 小数点位置约定在固定位置的数称为定点数，小数点位置约定为可以浮动的数称为浮点数。

## 1.2 数值的表示
+ 二进制
+ 二进制编码的十进制数(Binary Coded Decimal Number，简称 BCD)

表示一个数值要确定三个要素：进位计数制、定/浮点表示和编码规则。

## 1.3 进位计数制

一般用 B(Binary) 表示二进制，用 O(Octal) 表示八进制，用 D(Decimal) 表示十进制，用 H(Hexadecimal) 表示十六进制。

+ R 进制转换成十进制，**按权展开**
+ 十进制转换成 R 进制，将整数和小数部分分开转换
    + 整数部分转换，方法是 **除基取余，上右下左**，用转换的十进制整数去除以基数 R，将得到的余数作为结果数据中各位的数字，直到余数为 0 为止。上面的余数（先得到的余数）作为右边低位上的数位，下面的余数作左边高位上的数位。
    + 小数部分转换，方法是 **乘基取整，上左下右**，用要转换的十进制小数乘以基数 R，将得到的乘积的整数部分作为结果数据中各位的数字，小数部分继续与基数 R 相乘，以此类推，直到某一步乘积的小数部分为 0 或已得到希望的位数为止。
    + 含整数、小数部分的数的转换，将整数和小数部分分开转换，转换后将两部分组合起来得到一个完整的数。
+ 二、八、十六进制数的互相转换
    + 八进制转为二进制，把每一个八进制数字改写成等值的 3 位二进制数即可，且保持高低位的次序不变。
    + 十六进制转为二进制，把每一个十六进制的数字改写成等值的 4 位二进制数即可，且保持高低位次序不变。
    + 二进制转为八进制，整数部分从低位向高位方向每 3 位用一个等值的八进制数来替换，最后不足 3 位时在高位补 0 凑满 3 位。小数部分从高位向低位方向每 3 位用一个等值的八进制数来替换，最后不足 3 位时在低位补 0 凑满 3 位。
    + 二进制转为十六进制，整数部分从低位向高位方向每 4 位用一个等值的十六进制数来替换，最后不足 4 位时在高位补 0 凑满 4 位。小数部分从高位向低位方向每 3 位用一个等值的十六进制数来替换，最后不足 4 位时在低位补 0 凑满 4 位。

## 1.4 定点数的编码表示

### 1.4.1 原码

+ 正数的原码是其本身，负数的原码是其绝对值，+0 的原码是 +0，-0 的原码是 -0。
+ 优点：
    + 与日常记录正负数习惯接近
    + 原码实现乘除运算比较简便直接
+ 缺点：
    + 0 的表示不唯一，使用带来不便。
    + 原码的加减运算规则复杂，原码加减运算时，需要首先判断是否为异号相加或同好相减的情况，如果是的话，则必须先根据两个数的绝对值的大小关系来决定结果的正负号，再用绝对值大的数减去绝对值小的数。

**以 8 位为例：**
    + 数值 `+0`，原码表示为 `0000 0000`，`-0` 原码表示为 `1000 0000` 。
    + 数值 `100`，原码表示为 `0110 0100`，`-100` 原码表示为 `1110 0100` 。
    + 所以 8 位的取值范围为 `[1111 1111, 0111 1111]`

### 1.4.2 补码
+ 和原码转换：原码最高位是 0 时，原码与补码相同。原码最高位为 1 时，原码的最高位不变，其余位按位取反后末位加 1。
+ 求一个数的补码时取模运算，利用补码基于取模运算的特点，可以把减法转换为加法来做。这样不需要在计算机中把加法器和减法器分开。

### 1.4.3 溢出

+ 当同号数相加或者异号相减时，结果的数值可能就会超过该长度编码下的表示范围，称之为溢出。
+ 加法溢出的判断方法：如果 A 和 B 的最高位一样，但是 A + B 的结果的最高位与 A 和 B 的最高位不一样，表示溢出，即两个正数相加得负数，或两个负数相加得正数。
+ 减法溢出的判断方法：即负数减正数的结果时正数，或正数减负数的结果是负数，表示溢出。

### 1.4.4 反码

+ 正数的反码是其自身。
+ 负数的反码是在原码基础上，符号位不变，其余各位取反。

### 1.4.5 模运算

在模运算系统中，如果 A、B、M 满足以下关系 `A = B + K * M`(K 为正数)，则记为 `A = B(mod M)`。即 A、B 各除以 M 后的余数相同，称 B 和 A 为模 M 同余，就是说一个数与它除以 “模” 后得到的余数是等价的。

### 1.4.6 补码的定义

正数的补码是他本身，负数的补码是在原码的基础上，符号位不变，各位取反，最后+ 1。即 反码 + 1。

## 1.5 浮点数的表示

计算机中的浮点数表示沿用了科学计数法的表示方法，即包含了符号、尾数和阶码三个域。

符号用一位二进制码表示， 0 为正，1 为负。

计算机内部位宽为有限的，余下的尾数和解码两者间存在一个此消彼长的关系。

增加尾数的位宽会提高表示的精度，但是会减少表示的范围。

增加阶码的位宽会扩大表示的范围，但是会降低表示的精度。

1985 年，IEEE 完成了浮点数标准 IEEE 754 的制定。

+ IEEE 754 标准浮点数格式

定义了两种基本的浮点数格式，32 位的单精度格式和 64 位的双精度格式。

32 位单精度格式：包含 1 个符号位，8 位阶码和 23 位尾数。

64 位双精度格式：包含 1 个符号位，11 位阶码和 52 位尾数。

## 1.6 IEEE 754 特殊规定
+ 无穷大：阶码位 1 尾数全 0
    + 保证程序出现浮点异常可以正常执行
    + 位程序提供一种检测错误的途径
    + 无穷大作为源操作数时，可以得到无穷大的结果
+ 非数：阶码全 1 尾数非 0
    + 检测非初始化值的使用
    + 计算出现异常时程序可以继续执行下去
+ 规格化非 0 数：阶码非全 0 非全 1
    + 单精度：阶码 e 落在 `[1, 254]`。双精度：阶码 e 落在 `[1, 2046]`
+ 非规格化非 0 数：阶码全 0 尾数非 1
+ 零：阶码全 0 尾数全 0


# 2. 非数值数据的编码表示

## 2.1 西文字符

西文由拉丁字母、数组、标点符号及一些特殊符号组成，统称为字符(character)。所有字符的集合叫做字符集。

字符不能直接在计算机内部进行处理，因而必须对他们进行数字化编码。

字符集中每一个字符都有一个代码，构成了该字符集的代码表，简称码表。码表中的代码具有唯一性。

字符集有多重，每一个字符集的编码方式也不一样，目前计算机中使用最广泛的西文字符是 ASCII 码，即美国标准信息交换码(American Standard Code for Information Interchange)。

## 2.2 汉字字符

+ 汉字的输入码

每个汉字用一个或几个键来表示，这种对每个汉字用相应的按键进行的编码表示就成为汉字的输入码，又称外码。因此汉字的输入码的码元（即组成编码的基本元素）是西文键盘中的某个按键。

+ 字符集与汉字内码

汉字被输入到计算机内部后，按照一种内码的编码形式在系统中进行存储、查找、传送等处理。对于西文字符，它的内码就是 ASCII。

1981 年我国颁布了《信息交换用汉字编码字符集·基本集》（GB2312-80）。该标准选出 6763 个常用汉字，为每一个汉字规定了标准代码，以供汉字信息在不同计算机系统之间交换使用。这个标准成为 **国标码** ，又称 **国标交换码**。

**GB2312 国标字符集由三部分组成：**
    + 字母、数字和各种符号。包括英文、俄文、日文平假名与片假名、罗马字母、汉语拼音等共 687 个。
    + 一级常用汉字，用 3755 个，按汉语拼音排列。
    + 二级常用汉字，共 3008 个，因为不太常用，所以按偏旁部首排列。

+ 汉字的字模点阵码和轮廓描述

每一个汉字的字形都必须先存放在计算机中，一套汉字的所有字符的形状描述信息集合在一起称为 **字形信息库** ，简称 **字库(font library)**。不同的字体对应不同的字库，在输入的每一个汉字时，计算机都要先到字库中区找到它的字形描述信息，然后把字形信息送到相应的设备输出。

汉字的形主要有两种描述方法：字模点阵描述和轮廓描述。

字模点阵描述是将字库中的各个汉字或其他字符的字形（字模），用一个其元素由 0 和 1 组成的房展（16*16，24*24等）来表示，汉字或字符中有黑点的地方用 1 表示，空白处用 0 表示，这种方式二进制点阵数据称为汉字的 **字模点阵码** 。

汉字的 **轮廓描述** 方法比较复杂，它把汉字的笔画用一组直线和曲线来勾画，记下每一直线和曲线的数据描述公式，目前已有两类国际标准：Adobe Type1 和 True Type，这种轮廓描述字形的方式精度高，字形大小可以任意变化。

## 2.3 Unicode 标准

UTF-8 用于 HTML，与 ASCII 有相同的字节数值

UTF-16用于节约使用内存与高效访问字符相互平衡的环境中。比如 Windows 近期版本使用 UTF-16，其中的每一个字符都有一个 16 位的编码。

UTF-32 用于不考虑空间，但需要固定宽度字符的环境中，每一个字符都有 32 位的编码。
